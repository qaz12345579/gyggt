
-- ============================================
-- Roblox Universal ESP + Aimbot (완전 복원판)
-- 기반: WeAreDevs 난독화 코드 디코딩 결과
-- ============================================

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- ===== 설정 =====
local Settings = {
    ESP = {
        Enabled = true,
        Box = true,
        BoxColor = Color3.new(1, 0, 0),
        Name = true,
        NameColor = Color3.new(1, 1, 1),
        Distance = true,
        DistanceColor = Color3.new(0, 1, 1),
        HealthBar = true,
        HealthColor = Color3.new(0, 1, 0),
        Tracer = true,
        TracerColor = Color3.new(1, 1, 0),
    },
    Aimbot = {
        Enabled = true,
        TeamCheck = true,
        VisibleCheck = true,
        FOV = 90,
        HitPart = "Head",
    }
}

-- ===== ESP 드로잉 =====
local Drawings = {}

local function CreateESP(player)
    local esp = {}
    
    esp.Box = Drawing.new("Square")
    esp.Box.Visible = false
    esp.Box.Color = Settings.ESP.BoxColor
    esp.Box.Thickness = 1
    
    esp.Name = Drawing.new("Text")
    esp.Name.Visible = false
    esp.Name.Color = Settings.ESP.NameColor
    esp.Name.Size = 16
    esp.Name.Center = true
    esp.Name.Outline = true
    
    esp.Distance = Drawing.new("Text")
    esp.Distance.Visible = false
    esp.Distance.Color = Settings.ESP.DistanceColor
    esp.Distance.Size = 14
    esp.Distance.Center = true
    esp.Distance.Outline = true
    
    esp.HealthBar = Drawing.new("Square")
    esp.HealthBar.Visible = false
    esp.HealthBar.Color = Settings.ESP.HealthColor
    esp.HealthBar.Filled = true
    
    esp.Tracer = Drawing.new("Line")
    esp.Tracer.Visible = false
    esp.Tracer.Color = Settings.ESP.TracerColor
    esp.Tracer.Thickness = 1
    
    Drawings[player] = esp
end

-- ===== ESP 렌더 루프 =====
RunService.RenderStepped:Connect(function()
    if not Settings.ESP.Enabled then
        for _, esp in pairs(Drawings) do
            for _, obj in pairs(esp) do
                obj.Visible = false
            end
        end
        return
    end
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local character = player.Character
            if character then
                local root = character:FindFirstChild("HumanoidRootPart")
                if root then
                    local pos, onScreen = Camera:WorldToViewportPoint(root.Position)
                    if onScreen then
                        if not Drawings[player] then
                            CreateESP(player)
                        end
                        
                        local esp = Drawings[player]
                        local scale = 1 / (pos.Z * math.tan(Camera.FieldOfView * 0.5) * 2) * 1000
                        local width = scale * 2
                        local height = scale * 3
                        local x = pos.X - width / 2
                        local y = pos.Y - height / 2
                        
                        -- Box
                        if Settings.ESP.Box then
                            esp.Box.Visible = true
                            esp.Box.Position = Vector2.new(x, y)
                            esp.Box.Size = Vector2.new(width, height)
                        else
                            esp.Box.Visible = false
                        end
                        
                        -- Name
                        if Settings.ESP.Name then
                            esp.Name.Visible = true
                            esp.Name.Text = player.Name
                            esp.Name.Position = Vector2.new(pos.X, y - 20)
                        else
                            esp.Name.Visible = false
                        end
                        
                        -- Distance
                        if Settings.ESP.Distance and LocalPlayer.Character then
                            local myRoot = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                            if myRoot then
                                local dist = (myRoot.Position - root.Position).Magnitude
                                esp.Distance.Visible = true
                                esp.Distance.Text = math.floor(dist) .. "m"
                                esp.Distance.Position = Vector2.new(pos.X, y + height + 5)
                            end
                        else
                            esp.Distance.Visible = false
                        end
                        
                        -- HealthBar
                        local humanoid = character:FindFirstChild("Humanoid")
                        if humanoid and Settings.ESP.HealthBar then
                            local health = humanoid.Health / humanoid.MaxHealth
                            esp.HealthBar.Visible = true
                            esp.HealthBar.Position = Vector2.new(x - 6, y + height * (1 - health))
                            esp.HealthBar.Size = Vector2.new(4, height * health)
                        else
                            esp.HealthBar.Visible = false
                        end
                        
                        -- Tracer
                        if Settings.ESP.Tracer then
                            esp.Tracer.Visible = true
                            esp.Tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                            esp.Tracer.To = Vector2.new(pos.X, pos.Y)
                        else
                            esp.Tracer.Visible = false
                        end
                    end
                end
            end
        end
    end
end)

-- ===== Aimbot =====
UserInputService.InputBegan:Connect(function(input)
    if not Settings.Aimbot.Enabled then return end
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        local closest = nil
        local shortest = Settings.Aimbot.FOV
        
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                local character = player.Character
                if character then
                    local part = character:FindFirstChild(Settings.Aimbot.HitPart)
                    if part then
                        local pos, onScreen = Camera:WorldToViewportPoint(part.Position)
                        if onScreen then
                            local mousePos = UserInputService:GetMouseLocation()
                            local dist = (Vector2.new(mousePos.X, mousePos.Y) - Vector2.new(pos.X, pos.Y)).Magnitude
                            if dist < shortest then
                                shortest = dist
                                closest = part
                            end
                        end
                    end
                end
            end
        end
        
        if closest then
            local oldPos = Camera.CFrame
            local targetPos = closest.Position
            local newCFrame = CFrame.lookAt(oldPos.Position, targetPos)
            Camera.CFrame = newCFrame
        end
    end
end)

-- ===== 속도/점프 =====
LocalPlayer.CharacterAdded:Connect(function(char)
    char:WaitForChild("Humanoid").WalkSpeed = 50
    char:WaitForChild("Humanoid").JumpPower = 100
end)

print("Universal ESP + Aimbot Loaded!")
