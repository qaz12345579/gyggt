-- Rival Ultimate Silent Aim (100% ì ì¤‘ë¥  ëª©í‘œ)
-- íŒ€ ìë™ êµ¬ë¶„, ëª¨ë“  ì  í—¤ë“œìƒ·, ë²½ ë’¤ë„ ì¡°ì¤€, ëª¨ë°”ì¼ ì§€ì›
-- ì‹¤í–‰ë§Œ í•˜ë©´ ì¦‰ì‹œ ì ìš©, ë³„ë„ UI ì—†ìŒ

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- ================= ì„¤ì • =================
local SilentAim = true          -- true = ì‚¬ì¼ëŸ°íŠ¸ ì—ì„, false = ë”
local AimPart = "Head"         -- Head / HumanoidRootPart
-- ========================================

-- FireRemote ì°¾ê¸° (Rival êµ¬ì¡° ê¸°ë°˜)
local FireRemote = (function()
    local candidates = {
        ReplicatedStorage:FindFirstChild("Remotes"),
        ReplicatedStorage:FindFirstChild("Weapons"),
        ReplicatedStorage:FindFirstChild("Gun"),
        ReplicatedStorage:FindFirstChild("ShootEvent"),
    }
    for _, folder in ipairs(candidates) do
        if folder then
            for _, remote in ipairs(folder:GetChildren()) do
                if remote:IsA("RemoteEvent") and (
                    remote.Name:find("Fire") or
                    remote.Name:find("Shoot") or
                    remote.Name:find("Damage") or
                    remote.Name:find("Hit")
                ) then
                    return remote
                end
            end
        end
    end
    -- ì „ì²´ íƒìƒ‰ (Fallback)
    for _, obj in ipairs(ReplicatedStorage:GetDescendants()) do
        if obj:IsA("RemoteEvent") then
            local name = obj.Name
            if name:find("Fire") or name:find("Shoot") or name:find("Weapon") then
                return obj
            end
        end
    end
    return nil
end)()

-- Rival íŒ€ êµ¬ë¶„ (TeamColor ê¸°ì¤€)
local function IsEnemy(plr)
    if plr == LocalPlayer then return false end
    local myColor = LocalPlayer.TeamColor
    local targetColor = plr.TeamColor
    if myColor and targetColor then
        return myColor ~= targetColor
    end
    -- Team ì¸ìŠ¤í„´ìŠ¤ fallback
    local myTeam = LocalPlayer.Team
    local targetTeam = plr.Team
    if myTeam and targetTeam then
        return myTeam ~= targetTeam
    end
    return true
end

-- ìµœì  íƒ€ê²Ÿ ì°¾ê¸° (ì íŒ€, ê°€ì¥ ìœ„í˜‘ì ì¸ ì )
local function GetBestTarget()
    local myChar = LocalPlayer.Character
    if not myChar then return nil, nil end
    local myRoot = myChar:FindFirstChild("HumanoidRootPart")
    if not myRoot then return nil, nil end
    
    local cameraPos = Camera.CFrame.Position
    local cameraDir = Camera.CFrame.LookVector
    local bestTarget, bestPart, bestScore = nil, nil, math.huge
    
    for _, plr in ipairs(Players:GetPlayers()) do
        if not IsEnemy(plr) then continue end
        local char = plr.Character
        if not char then continue end
        local humanoid = char:FindFirstChildOfClass("Humanoid")
        if not humanoid or humanoid.Health <= 0 then continue end
        
        local head = char:FindFirstChild("Head")
        local root = char:FindFirstChild("HumanoidRootPart")
        if not root then continue end
        
        local aimPart = (AimPart == "Head" and head) or root
        if not aimPart then aimPart = root end
        
        local targetPos = aimPart.Position
        local toTarget = (targetPos - cameraPos).Unit
        local dot = cameraDir:Dot(toTarget)
        local angle = math.deg(math.acos(math.clamp(dot, -1, 1)))
        
        -- ì‹œì•¼ê° ì œí•œ ì—†ìŒ (360ë„ ëª¨ë‘ ê°ì§€)
        local dist = (targetPos - cameraPos).Magnitude
        if dist > 2000 then continue end
        
        -- í™”ë©´ ì¤‘ì•™ê³¼ì˜ ê±°ë¦¬
        local screenPos, onScreen = Camera:WorldToViewportPoint(targetPos)
        local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
        local screenDist = onScreen and (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).Magnitude or 9999
        
        -- ì ìˆ˜ = ê±°ë¦¬ * 0.5 + í™”ë©´ê±°ë¦¬ * 0.5
        local score = dist * 0.5 + screenDist * 0.5
        if score < bestScore then
            bestScore = score
            bestTarget = char
            bestPart = aimPart
        end
    end
    return bestTarget, bestPart
end

-- FireRemote í›„í‚¹ (ì‚¬ì¼ëŸ°íŠ¸ ì—ì„ í•µì‹¬)
if FireRemote and SilentAim then
    local original = FireRemote.FireServer
    FireRemote.FireServer = function(self, ...)
        if not SilentAim then
            return original(self, ...)
        end
        
        local target, targetPart = GetBestTarget()
        if target and targetPart then
            local args = {...}
            -- ì¸ì ìˆœíšŒí•˜ë©° Vector3(ìœ„ì¹˜)ë¥¼ íƒ€ê²Ÿ ìœ„ì¹˜ë¡œ êµì²´
            for i, v in ipairs(args) do
                if typeof(v) == "Vector3" then
                    args[i] = targetPart.Position
                elseif type(v) == "table" then
                    -- í…Œì´ë¸” ë‚´ë¶€ Vector3 ê²€ì‚¬ (ì¬ê·€ëŠ” ìƒëµ, 1ë‹¨ê³„ë§Œ)
                    for key, val in pairs(v) do
                        if typeof(val) == "Vector3" then
                            v[key] = targetPart.Position
                        end
                    end
                end
            end
            return original(self, unpack(args))
        end
        
        return original(self, ...)
    end
    print("âœ… Rival Silent Aim í›„í‚¹ ì„±ê³µ! FireRemote:", FireRemote.Name)
else
    warn("âŒ FireRemoteë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²Œì„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
end

-- ìë™ íŒ€ ê°ì§€ ë° íƒ€ê²ŸíŒ… ë£¨í”„ (ë””ë²„ê·¸ìš©, í•„ìš”ì‹œ ì£¼ì„ì²˜ë¦¬)
RunService.Heartbeat:Connect(function()
    if SilentAim then
        local t, p = GetBestTarget()
        if t then
            -- ì¡°ìš©íˆ ë™ì‘, ì•„ë¬´ ì¶œë ¥ ì—†ìŒ
        end
    end
end)

-- í† ê¸€ ë‹¨ì¶•í‚¤: Insert í‚¤ (ëª¨ë°”ì¼ì€ í„°ì¹˜ 3ì´ˆ í™€ë“œë¡œ ëŒ€ì²´ ê°€ëŠ¥, ì—¬ê¸°ì„  ê°„ë‹¨íˆ)
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.Insert then
        SilentAim = not SilentAim
        print("ğŸ”« Silent Aim:", SilentAim and "ON" or "OFF")
    end
end)

print("ğŸš€ Rival Silent Aim ë¡œë“œ ì™„ë£Œ! Insert í‚¤ë¡œ í† ê¸€")
